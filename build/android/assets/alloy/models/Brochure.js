var Alloy=require("alloy"),_=require("alloy/underscore")._,model,collection;exports.definition={config:{columns:{id:"INTEGER",title:"TEXT",cover:"TEXT",content:"TEXT",url:"TEXT",status:"INTEGER",isDownloaded:"INTEGER",format:"TEXT"},adapter:{type:"sql",collection_name:"brochure"}},extendModel:function(e){return _.extend(e.prototype,{}),e},extendCollection:function(e){return _.extend(e.prototype,{getBrochureList:function(){var e=this,i="SELECT * FROM "+e.config.adapter.collection_name+"  order by id";db=Ti.Database.open(e.config.adapter.db_name);for(var t=db.execute(i),o=[],a=0;t.isValidRow();)o[a]={id:t.fieldByName("id"),title:t.fieldByName("title"),cover:t.fieldByName("cover"),content:t.fieldByName("content"),url:t.fieldByName("url"),isDownloaded:t.fieldByName("isDownloaded"),status:t.fieldByName("status"),format:t.fieldByName("format")},t.next(),a++;return t.close(),db.close(),e.trigger("sync"),o},addBrochure:function(e,i,t,o,a,l,r){var _=this,n="SELECT * FROM "+_.config.adapter.collection_name+" WHERE id="+e,s="";db=Ti.Database.open(_.config.adapter.db_name);var d=db.execute(n);s=d.isValidRow()?"UPDATE "+_.config.adapter.collection_name+" SET title='"+i+"', cover='"+t+"', content='"+o+"', status='"+l+"' WHERE id='"+e+"'":"INSERT INTO "+_.config.adapter.collection_name+" (id, title, cover,content, url,status, isDownloaded,format ) VALUES ('"+e+"','"+i+"','"+t+"','"+o+"','"+a+"','"+l+"', 0, '"+r+"')",db.execute(s),db.close(),_.trigger("sync")},updateDownloadedBrochure:function(e){var i=this;sql_query="UPDATE "+i.config.adapter.collection_name+" SET isDownloaded=1 WHERE id='"+e+"'",db=Ti.Database.open(i.config.adapter.db_name),db.execute(sql_query),db.close(),i.trigger("sync")},resetBrochure:function(){var e=this,i="DELETE FROM "+e.config.adapter.collection_name;db=Ti.Database.open(e.config.adapter.db_name),db.execute(i),db.close(),e.trigger("sync")},getDownloadedList:function(){var e=this,i="SELECT * FROM "+e.config.adapter.collection_name+" WHERE isDownloaded=1 order by id DESC";db=Ti.Database.open(e.config.adapter.db_name);for(var t=db.execute(i),o=[],a=0;t.isValidRow();)o[a]={id:t.fieldByName("id"),title:t.fieldByName("title"),cover:t.fieldByName("cover"),content:t.fieldByName("content"),url:t.fieldByName("url"),isDownloaded:t.fieldByName("isDownloaded"),status:t.fieldByName("status"),format:t.fieldByName("format")},t.next(),a++;return t.close(),db.close(),e.trigger("sync"),o},getVideoList:function(){var e=this,i="SELECT * FROM "+e.config.adapter.collection_name+" WHERE format!='pdf' order by id DESC";db=Ti.Database.open(e.config.adapter.db_name);for(var t=db.execute(i),o=[],a=0;t.isValidRow();)o[a]={id:t.fieldByName("id"),title:t.fieldByName("title"),cover:t.fieldByName("cover"),content:t.fieldByName("content"),url:t.fieldByName("url"),isDownloaded:t.fieldByName("isDownloaded"),status:t.fieldByName("status"),format:t.fieldByName("format")},t.next(),a++;return t.close(),db.close(),e.trigger("sync"),o}}),e}},model=Alloy.M("brochure",exports.definition,[]),collection=Alloy.C("brochure",exports.definition,model),exports.Model=model,exports.Collection=collection;