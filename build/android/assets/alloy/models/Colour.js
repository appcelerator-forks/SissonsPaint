var Alloy=require("alloy"),_=require("alloy/underscore")._,model,collection;exports.definition={config:{columns:{id:"INTEGER",name:"TEXT",code:"TEXT",rgb:"TEXT",cmyk:"TEXT",sample:"TEXT",thumb:"TEXT"},adapter:{type:"sql",collection_name:"colour"}},extendModel:function(e){return _.extend(e.prototype,{}),e},extendCollection:function(e){return _.extend(e.prototype,{getColourList:function(){var e=this,i="SELECT * FROM "+e.config.adapter.collection_name+"  order by id DESC";db=Ti.Database.open(e.config.adapter.db_name);for(var t=db.execute(i),o=[],a=0;t.isValidRow();){var r=t.fieldByName("rgb").split(/,\s*/);o[a]={id:t.fieldByName("id"),name:t.fieldByName("name"),code:t.fieldByName("code"),rgb:t.fieldByName("rgb"),cmyk:t.fieldByName("cmyk"),sample:t.fieldByName("sample"),thumb:t.fieldByName("thumb"),contrast:parseInt(r[0])+parseInt(r[1])+parseInt(r[2])},t.next(),a++}return t.close(),db.close(),e.trigger("sync"),o},getColourById:function(e){var i=this,t="SELECT * FROM "+i.config.adapter.collection_name+" WHERE id='"+e+"'";db=Ti.Database.open(i.config.adapter.db_name);var o=db.execute(t),a=[];return o.isValidRow()&&(a={id:o.fieldByName("id"),name:o.fieldByName("name"),code:o.fieldByName("code"),rgb:o.fieldByName("rgb"),cmyk:o.fieldByName("cmyk"),sample:o.fieldByName("sample"),thumb:o.fieldByName("thumb")}),o.close(),db.close(),i.trigger("sync"),a},resetColour:function(){var e=this,i="DELETE FROM "+e.config.adapter.collection_name;db=Ti.Database.open(e.config.adapter.db_name),db.execute(i),db.close(),e.trigger("sync")},getColourByQuery:function(e){var i=this,t="SELECT * FROM "+i.config.adapter.collection_name+" WHERE name LIKE '%"+e+"%' OR code='%"+e+"%'";db=Ti.Database.open(i.config.adapter.db_name);for(var o=db.execute(t),a=[],r=0;o.isValidRow();)a[r]={id:o.fieldByName("id"),name:o.fieldByName("name"),code:o.fieldByName("code"),rgb:o.fieldByName("rgb"),cmyk:o.fieldByName("cmyk"),sample:o.fieldByName("sample"),thumb:o.fieldByName("thumb")},o.next(),r++;return o.close(),db.close(),i.trigger("sync"),a},addColours:function(e){var i=this;db=Ti.Database.open(i.config.adapter.db_name),db.execute("BEGIN"),e.forEach(function(e){sql_query="INSERT INTO "+i.config.adapter.collection_name+"(id, name, code,RGB, CMYK,sample, thumb ) VALUES ('"+e.id+"', '"+e.name+"', '"+e.code+"', '"+e.RGB+"', '"+e.CMYK+"', '"+e.sample+"', '"+e.thumb+"')",db.execute(sql_query)}),db.execute("COMMIT"),db.close(),i.trigger("sync")},getClosestColourList:function(e,i,t){var o=this,a="SELECT * FROM "+o.config.adapter.collection_name+"  order by id DESC";db=Ti.Database.open(o.config.adapter.db_name);for(var r=db.execute(a),l=[];r.isValidRow();){var n=r.fieldByName("rgb").split(/,\s*/),s=50,_=-1,d=Math.abs(e-n[0]),c=Math.abs(i-n[1]),w=Math.abs(t-n[2]),h=Math.max(d,c,w);if(s>=h){for(var u=0;u<l.length;u++)if(h<=l[u].diff){_=u;break}0>_&&(_=l.length),l.splice(_,0,{id:r.fieldByName("id"),name:r.fieldByName("name"),code:r.fieldByName("code"),rgb:r.fieldByName("rgb"),cmyk:r.fieldByName("cmyk"),sample:r.fieldByName("sample"),thumb:r.fieldByName("thumb"),diff:h})}r.next()}return r.close(),db.close(),o.trigger("sync"),l}}),e}},model=Alloy.M("colour",exports.definition,[]),collection=Alloy.C("colour",exports.definition,model),exports.Model=model,exports.Collection=collection;