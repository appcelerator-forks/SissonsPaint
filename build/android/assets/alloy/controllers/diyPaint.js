function __processArg(e,t){var i=null;return e&&(i=e[t]||null,delete e[t]),i}function Controller(){function e(e){return e/(Titanium.Platform.displayCaps.dpi/160)}function t(e){var t=Titanium.UI.createAnimation({bottom:e,duration:500,curve:Titanium.UI.ANIMATION_CURVE_LINEAR});h.sizeBar.animate(t)}function i(){Ti.App.fireEvent("web:saveAndShare")}function o(e){"color"==e.source.mod?(x?(a(-330),x=0):(a(60),x=1),C=0,t(0)):(C?(t(0),C=0):(t(60),C=1),x=0,a(-330))}function a(e){var t=Titanium.UI.createAnimation({bottom:e,duration:500,curve:Titanium.UI.ANIMATION_CURVE_LINEAR});h.colorSwatches.animate(t)}function r(){D(),1==N?(N=0,h.diyPaint.remove(R)):(N=1,h.diyPaint.add(R),R.addEventListener("click",B))}function l(e){"bucket"==E?(y=parseInt(e.value),Ti.App.fireEvent("web:setSensetive",{value:y})):"brush"==E?(T=parseInt(e.value),Ti.App.fireEvent("web:setStroke",{value:T})):"erase"==E&&(f=parseInt(e.value),Ti.App.fireEvent("web:setStroke",{value:f}))}function n(){var e=Titanium.UI.createOptionDialog({title:"Choose an image source...",options:["Camera","Photo Gallery","Cancel"],cancel:2});e.addEventListener("click",function(e){0==e.index?Titanium.Media.showCamera({success:function(e){var t=e.media;e.mediaType==Ti.Media.MEDIA_TYPE_PHOTO&&(Ti.App.Properties.setString("image",t.nativePath),Ti.App.fireEvent("web:loadImage",{image:t.nativePath}))},cancel:function(){},error:function(e){var t=Titanium.UI.createAlertDialog({title:"Camera"});t.setMessage(e.code==Titanium.Media.NO_CAMERA?"Device does not have camera":"Unexpected error: "+e.code),t.show()},allowImageEditing:!0,saveToPhotoGallery:!0}):1==e.index&&(Ti.App.fireEvent("foo",{name:"bar"}),Titanium.Media.openPhotoGallery({success:function(e){var t=e.media;e.mediaType==Ti.Media.MEDIA_TYPE_PHOTO&&(Ti.App.Properties.setString("image",t.nativePath),console.log(t.nativePath),Ti.App.fireEvent("web:loadImage",{image:t.nativePath}))},cancel:function(){}}))}),e.show()}function s(){for(var e=50*Math.ceil(S.length)+10,t=Titanium.UI.createView({layout:"horizontal",bottom:10,height:40,width:e}),i=0;i<S.length;i++){var o=b.getColourById(S[i].colour_id),a=h.UI.create("View",{backgroundColor:"rgb("+o.rgb+")",borderColor:"#A5A5A5",borderWidth:1,width:"40",height:"40",left:"5",right:"5"});d(a,o),t.add(a)}h.recommendView.add(t)}function d(e,i){e.addEventListener("click",function(){var e=i.rgb.split(","),o=rgbToHex(e[0],e[1],e[2]);h.color.setBackgroundColor(o),Ti.App.fireEvent("web:setColour",{r:e[0],g:e[1],b:e[2],hex:o}),x?(a(-330),x=0):(a(60),x=1),C=0,t(0)})}function c(){for(var e=50*Math.ceil(L.length/3)+10,t=Titanium.UI.createView({layout:"horizontal",bottom:10,height:40,width:e}),i=Titanium.UI.createView({layout:"horizontal",bottom:10,height:40,width:e}),o=Titanium.UI.createView({layout:"horizontal",height:40,width:e}),a=-1,r=[],l=0;l<L.length;l++){a=r.length;for(var n=0;n<r.length;n++)if(L[l].contrast>=r[n].contrast){a=n;break}r.splice(a,0,L[l])}for(var l=0;l<r.length;l++){console.log(r[l].contrast);var s=h.UI.create("View",{backgroundColor:"rgb("+r[l].rgb+")",borderColor:"#A5A5A5",borderWidth:1,width:"40",height:"40",left:"5",right:"5"});(l+1)%3==1?t.add(s):(l+1)%3==2?i.add(s):(l+1)%3==0&&o.add(s),d(s,r[l])}h.scrollView.add(t),h.scrollView.add(i),h.scrollView.add(o)}require("alloy/controllers/BaseController").apply(this,Array.prototype.slice.call(arguments)),this.__controllerPath="diyPaint",arguments[0]&&(__processArg(arguments[0],"__parentSymbol"),__processArg(arguments[0],"$model"),__processArg(arguments[0],"__itemTemplate"));var h=this,u={},g={};h.__views.diyPaint=Ti.UI.createView({id:"diyPaint"}),h.__views.diyPaint&&h.addTopLevelView(h.__views.diyPaint),h.__views.__alloyId51=Ti.UI.createView({backgroundColor:"white",id:"__alloyId51"}),h.__views.diyPaint.add(h.__views.__alloyId51),h.__views.toggle=Ti.UI.createView({id:"toggle",layout:"horizontal",height:"80",top:"0"}),h.__views.__alloyId51.add(h.__views.toggle),h.__views.__alloyId52=Alloy.createController("toggle",{id:"__alloyId52",__parentSymbol:h.__views.toggle}),h.__views.__alloyId52.setParent(h.__views.toggle),h.__views.__alloyId53=Ti.UI.createLabel({width:"75%",height:Ti.UI.SIZE,color:"black",font:{fontSize:22},text:"DIY Paint",textAlign:Ti.UI.TEXT_ALIGNMENT_CENTER,id:"__alloyId53"}),h.__views.toggle.add(h.__views.__alloyId53),h.__views.canvas=Ti.UI.createWebView({id:"canvas",url:"/html/canvas-paint-bucket.html",height:"200",enableZoomControls:"false",overScrollMode:Titanium.UI.Android.OVER_SCROLL_NEVER}),h.__views.__alloyId51.add(h.__views.canvas),h.__views.colorSwatches=Ti.UI.createView({layout:"vertical",height:"330",bottom:"-330",id:"colorSwatches"}),h.__views.__alloyId51.add(h.__views.colorSwatches),h.__views.__alloyId54=Ti.UI.createImageView({image:"/images/scroll_up.png",backgroundColor:"transparent",width:Titanium.UI.FILL,id:"__alloyId54"}),h.__views.colorSwatches.add(h.__views.__alloyId54),h.__views.bottomColorBar=Ti.UI.createView({id:"bottomColorBar",layout:"vertical",backgroundColor:"white"}),h.__views.colorSwatches.add(h.__views.bottomColorBar),h.__views.__alloyId55=Ti.UI.createLabel({width:"90%",height:Ti.UI.SIZE,color:"black",text:"FAVOURITE COLOURS",textAlign:Ti.UI.TEXT_ALIGNMENT_LEFT,bottom:"10",id:"__alloyId55"}),h.__views.bottomColorBar.add(h.__views.__alloyId55),h.__views.recommendView=Ti.UI.createScrollView({id:"recommendView",backgroundColor:"white",layout:"horizontal",scrollType:"horizontal",height:"50",overScrollMode:Titanium.UI.Android.OVER_SCROLL_NEVER}),h.__views.bottomColorBar.add(h.__views.recommendView),h.__views.__alloyId56=Ti.UI.createImageView({image:"/images/scroll_up.png",backgroundColor:"transparent",width:Titanium.UI.FILL,id:"__alloyId56"}),h.__views.bottomColorBar.add(h.__views.__alloyId56),h.__views.__alloyId57=Ti.UI.createLabel({width:"90%",height:Ti.UI.SIZE,color:"black",text:"COLOUR LIBRARY",textAlign:Ti.UI.TEXT_ALIGNMENT_LEFT,bottom:"10",id:"__alloyId57"}),h.__views.bottomColorBar.add(h.__views.__alloyId57),h.__views.scrollView=Ti.UI.createScrollView({id:"scrollView",backgroundColor:"white",layout:"vertical",scrollType:"horizontal",height:"150",overScrollMode:Titanium.UI.Android.OVER_SCROLL_NEVER}),h.__views.bottomColorBar.add(h.__views.scrollView),h.__views.sizeBar=Ti.UI.createView({height:"60",bottom:"0",width:"100%",id:"sizeBar"}),h.__views.__alloyId51.add(h.__views.sizeBar),h.__views.slider=Ti.UI.createSlider({id:"slider",min:"0",max:"100",value:"20"}),h.__views.sizeBar.add(h.__views.slider),l?h.__views.slider.addEventListener("stop",l):g["$.__views.slider!stop!updateAdjustment"]=!0,h.__views.toolbar=Ti.UI.createView({height:"60",bottom:"0",id:"toolbar"}),h.__views.__alloyId51.add(h.__views.toolbar),h.__views.__alloyId58=Ti.UI.createImageView({image:"/images/tool_bar.jpg",height:"60",width:Titanium.UI.FILL,id:"__alloyId58"}),h.__views.toolbar.add(h.__views.__alloyId58),h.__views.photoButton=Ti.UI.createImageView({id:"photoButton",image:"/images/icon_photo.png",left:"5",height:"40",width:"50"}),h.__views.toolbar.add(h.__views.photoButton),n?h.__views.photoButton.addEventListener("click",n):g["$.__views.photoButton!click!takePhoto"]=!0,h.__views.tools=Ti.UI.createImageView({id:"tools",image:"/images/icon_bucket.png",left:"125",height:"40",width:"50"}),h.__views.toolbar.add(h.__views.tools),r?h.__views.tools.addEventListener("click",r):g["$.__views.tools!click!toolspop"]=!0,h.__views.size=Ti.UI.createImageView({id:"size",image:"/images/icon_size.png",left:"185",mod:"size",height:"40",width:"50"}),h.__views.toolbar.add(h.__views.size),o?h.__views.size.addEventListener("click",o):g["$.__views.size!click!slideUp"]=!0,h.__views.color=Ti.UI.createView({id:"color",backgroundColor:"#ffffff",left:"245",height:"40",width:"50",mod:"color",borderColor:"#000000",borderWidth:"3",borderRadius:"10"}),h.__views.toolbar.add(h.__views.color),o?h.__views.color.addEventListener("click",o):g["$.__views.color!click!slideUp"]=!0,h.__views.__alloyId59=Ti.UI.createImageView({id:"__alloyId59",image:"/images/icon_share.png",left:"305",height:"40",width:"50"}),h.__views.toolbar.add(h.__views.__alloyId59),i?h.__views.__alloyId59.addEventListener("click",i):g["$.__views.__alloyId59!click!share"]=!0,u.destroy=function(){},_.extend(h,h.__views),arguments[0]||{};var w=Ti.Platform.displayCaps.platformWidth,v=e(Ti.Platform.displayCaps.platformHeight),I=h.toolbar.rect.height,p=h.toggle.getHeight(),m=0,y=h.slider.value,T=10,f=10,E="bucket";Alloy.createCollection("category_colour");var b=Alloy.createCollection("colour"),A=Alloy.createCollection("category"),U=Alloy.createCollection("favourite"),S=U.getFavouriteList();A.getCategoryListByType(2);var L=b.getColourList(),C=0,x=0,N=0;h.toolbar.addEventListener("postlayout",function(){I=h.toolbar.rect.height,m=v-I-25-p,console.log("page height: "+v+", toolbar:"+I+", toggle"+p+", canvas:"+m),h.canvas.setBottom(I),h.canvas.setHeight(m)}),h.canvas.addEventListener("load",function(){console.log(m),console.log(w),Ti.App.fireEvent("web:initCanvasSize",{height:m,width:w})});var V=[],k=Ti.UI.createTableViewRow({title:"Bucket",width:150,left:10,touchEnabled:!0,height:60}),P=Ti.UI.createTableViewRow({title:"Brush",width:150,left:10,touchEnabled:!0,height:60}),O=Ti.UI.createTableViewRow({title:"Eraser",width:150,left:10,touchEnabled:!0,height:60});V.push(k),V.push(P),V.push(O);var R=Titanium.UI.createTableView({separatorColor:"transparent",backgroundImage:"/images/pop_window.png",height:Ti.UI.SIZE,width:150,bottom:60,overScrollMode:Titanium.UI.Android.OVER_SCROLL_NEVER,data:V}),B=function(e){N=0,h.diyPaint.remove(R),0==e.index&&(E="bucket",h.slider.setValue(y),Ti.App.fireEvent("web:setSensetive",{value:y}),Ti.App.fireEvent("web:changeTools",{tools:"bucket"}),h.tools.image="/images/icon_bucket.png"),1==e.index&&(E="brush",h.slider.setValue(T),Ti.App.fireEvent("web:setStroke",{value:T}),Ti.App.fireEvent("web:changeTools",{tools:"brush"}),h.tools.image="/images/icon_brush.png"),2==e.index&&(E="erase",h.slider.setValue(f),Ti.App.fireEvent("web:setStroke",{value:f}),Ti.App.fireEvent("web:changeTools",{tools:"erase"}),h.tools.image="/images/icon_erase.png")},D=function(){R.removeEventListener("click",B)};setTimeout(function(){s(),c()},0),Ti.App.addEventListener("app:saveToGallery",function(e){var t=e.blob,i=t.indexOf("base64,");t=t.substring(i+"base64,".length);var o=Ti.Utils.base64decode(t),a="sissons_diy"+printDate()+".png",r=Titanium.Filesystem.getFile(Titanium.Filesystem.externalStorageDirectory);r.exists()||r.createDirectory();var l=Titanium.Filesystem.getFile(r.resolve(),a);alert(!1===l.write(o)?"Saved FAILED":"Saved Done"),l=null,r=null}),g["$.__views.slider!stop!updateAdjustment"]&&h.__views.slider.addEventListener("stop",l),g["$.__views.photoButton!click!takePhoto"]&&h.__views.photoButton.addEventListener("click",n),g["$.__views.tools!click!toolspop"]&&h.__views.tools.addEventListener("click",r),g["$.__views.size!click!slideUp"]&&h.__views.size.addEventListener("click",o),g["$.__views.color!click!slideUp"]&&h.__views.color.addEventListener("click",o),g["$.__views.__alloyId59!click!share"]&&h.__views.__alloyId59.addEventListener("click",i),_.extend(h,u)}var Alloy=require("alloy"),Backbone=Alloy.Backbone,_=Alloy._;module.exports=Controller;